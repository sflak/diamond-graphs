<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">

    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,500|Cutive" rel="stylesheet">
    <link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
    <!-- <link href="https://fonts.googleapis.com/css?family=Cutive" rel="stylesheet"> -->

    <!-- INCLUDE JQUERY -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
    <!-- INCLUDE D3.js -->
    <div id="version3"></div>
    <div id="version5"></div>
    <script src="https://d3js.org/d3.v5.js"></script>
    <!-- INCLUDE TIMESERIES.js -->
    <script src="js/timeseries.js"></script>
    <!-- INCLUDE underscore.js -->
    <script src="http://underscorejs.org/underscore-min.js"></script>
    <!-- INCLUDE moment.js -->
    <script src="http://momentjs.com/downloads/moment.js"></script>
    <!-- INCLUDE highlight.min.js -->
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
    <!-- INCLUDE lodash.js -->
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.1.0/lodash.min.js"></script>
    <!-- INCLUDE d3pie.js -->
    <script src="js/d3pie.min.js"></script>
    <!-- INCLUDE pie.js -->
    <script src="js/pie.js"></script>
    <!-- INCLUDE time.js -->
    <script src="js/time.js"></script>
    
    <script src="js/convert.js"></script>


    <script src="https://cdn.rawgit.com/eligrey/canvas-toBlob.js/f1a01896135ab378aa5c0118eadd81da55e698d8/canvas-toBlob.js"></script>
	<script src="https://cdn.rawgit.com/eligrey/FileSaver.js/e9d941381475b5df8b7d7691013401e171014e89/FileSaver.min.js"></script>



    <link rel="stylesheet" href="css/styles.css">


    <title>CMPS 119 PROJECT</title>
  </head>
  <body>

    <header class="header">
        <div class="row">
            <img class="logo" src="img/diamond-logo@2x.png" alt="logo">
            <h1>Diamond Graphs</h1>
            <div class="col-3-of-4">
                <p>This tool allows your organization to make great data visualizations. Simply upload your data, choose your desired visualization, and we do the rest! When you're done, you can download the visualization as a .PNG, so you can display it anywhwere.</p>
            </div>
        </div>
    </header>

    <section class="graph">
        <div class="row">
            <div class="col-1-of-3">
                <form action="#" id="graphForm">
                    <div class="inputs">
                        <div class="inputs__main">
                            <!-- File Input -->
                            <label for="file" class="uploader">
                                <input type="file" id="file" accept=".csv">
                                <span>Upload CSV <i class="far fa-file"></i></span>
                            </label>
                            <p class="filename" id="filename"></p><div class="deleteFile" id="deleteFile">X</div>
                            <span class="betweenText">OR</span>

                            <!-- sheets link input -->
                            <label for="driveLink" class="inputs__main__label">Paste your Google Sheets Shareable Link:</label>
                            
                            <input type="text" class="inputs__main__drive-input" id="driveLink" placeholder="ex: https://docs.google.com/spreadsheets/d/e/<ID>/pub?output=csv">
                            <p class="inputs__main__instruc">To get the correct link from Google Sheets, go to File &rarr; Advanced &rarr; Publish to the web. Then select Comma Separated Values from the drop down. Copy the resulting link and paste it here. For more detailed instructions, go <a target="blank" href="https://goo.gl/Lc474y">here</a>.</p>
                            <span class="betweenText">Visualization:</span>
                            <div class="select">
                                <!-- <span><i class="fas fa-chevron-down"></i></span> -->
                                <label for="graph-type" class="inputs__main__label">Choose you visualization</label>
                                <select name="Visualization Types" class="inputs__main--select" id="graph-type">
                                    <option value="bar">Bar</option>
                                    <option value="line">Line</option>
                                    <option value="map">Map</option>
                                    <option value="bubble">Bubble</option>
                                    <option value="timeseries">Time Instances</option>
                                    <option value="piechart">Pie Chart</option>
                                </select>
                                <div id="dataFormatInst">
                                </div>
                            </div>
                        </div>
                        <div id="wrapper">
                            
                        </div>
                        <!-- <div class="inputs__options">
                            
                            <input id="title" type="text" name="title" placeholder="Title" value="">
                            <input id="xaxis" type="text" name="xaxis" placeholder="X-Axis Label" value="">
                            <input id="yaxis" type="text" name="yaxis" placeholder="Y-Axis Label" value="">
                            <p class="optText">options...</p>
                            <hr>
                            <div class="inputs__options--graph">
                                <div class="row">
                                    <div class="col-1-of-2">
                                        <select class="inputs__options--select">
                                            <option value="bar">opt1</option>
                                            <option value="line">opt2</option>
                                            <option value="map">opt3</option>
                                            <option value="bubble">opt4</option>
                                        </select>
                                        <select class="inputs__options--select">
                                            <option value="bar">opt1</option>
                                            <option value="line">opt2</option>
                                            <option value="map">opt3</option>
                                            <option value="bubble">opt4</option>
                                        </select>
                                    </div>
                                    <div class="col-1-of-2">
                                        <select class="inputs__options--select">
                                            <option value="bar">opt1</option>
                                            <option value="line">opt2</option>
                                            <option value="map">opt3</option>
                                            <option value="bubble">opt4</option>
                                        </select>
                                        <select class="inputs__options--select">
                                            <option value="bar">opt1</option>
                                            <option value="line">opt2</option>
                                            <option value="map">opt3</option>
                                            <option value="bubble">opt4</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            
                        </div> -->
                        <button id="submit" type="submit" class="inputs__options__submit">SUBMIT</button>
                    </div>

                        
                </form>
                
                
            </div>
            <div class="col-2-of-3">
                <div class="graph-section" id="graph-section">

                </div>
                <div class="download" id='saveButton'>Download <i class="fas fa-download"></i></div>
                <!-- <button id='saveButton'>Export my D3 visualization to PNG</button> -->

            </div>
        </div>
    </section>
    <!-- <section class="embed-code">
        <div class="row">
            <div class="col-2-of-3">
                <div class="embed-code__section">
                    <p>Copy and paste this code to show this visualization in your website...</p>
                    <div class="embed-code__section__text"></div>
                </div>
                
            </div>
        </div>
    </section> -->

    <footer></footer>

    <!-- HELPER FUNCTIONS -->
    <script type="text/javascript">
        
        var sub = document.getElementById("submit");
        sub.addEventListener("click", function(){parseInputs()}, false);
    
        // Parse the title, xaxis, yaxis of inputs
        function parseInputs () {
            let inputs = [document.getElementById("title").value,
            document.getElementById("xaxis").value,
            document.getElementById("yaxis").value
            ];
            console.log(inputs);
            return inputs;
        }
        document.getElementById('saveButton').addEventListener('click', function(){
            var svg = document.getElementById('graph-section').children[0];
	        var svgString = getSVGString(svg);
	        svgString2Image( svgString, svg.width.baseVal.value, svg.height.baseVal.value, 'png', save ); // passes Blob and filesize String to the callback
	        function save( dataBlob, filesize ){
	    	    saveAs( dataBlob, 'D3 vis exported to PNG.png' ); // FileSaver.js function
            }
            console.log("does this work")
        });
        // On graph type change, change options.
        // TODO: Dynamically change options when a visualization type is selected
        function report (value) {

            //THIS WILL GO ELSEWHERE, for now generates preset timeseries graph
            // if(value=="timeseries"){
            //     console.log("generate " + value + " graph")
            //     var domEl = 'graph-section';
            //     var data = [{'value': 1380854103662},{'value': 1363641921283}
            //         ,{'value': 1361111111183}];
            //     var brushEnabled = false;
            //     var tseries = new timeseries(domEl, data, brushEnabled, "graph-section");
            // }
        }

    
    </script>
     <script src="js/bar.js"></script>
     <script src="js/papaparse.min.js"></script>
     <script src="js/bubbleChart.js"></script>
     <script src="js/index.js"></script>
     

    </body>
</html>